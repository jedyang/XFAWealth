[#include "../../inc/head_v2.html"/]
<link rel="stylesheet" type="text/css" href="${base}/res/css/wmes_console.css">
<link href="${base}/res/console/css/bootstrap-3.3.4.css" rel="stylesheet" type="text/css">
<link href="${base}/res/console/css/css.css" rel="stylesheet" type="text/css">

<div class="wmes-content" id="wmes_wraper">
	<div class="ifa_choose_condition">
		<div class="wmes-wrap-title" style="height:16px;">
			<p>用户管理</p>
		</div>
	</div>
	<ul class="tab" id="tab-search">
		<li class="tab-li-crr" id="individual_tab">
			<a href="javascript:;">[@lang_res k='member.individual'/]</a>
		</li>
		<li id="fi_tab">
			<a href="javascript:;">[@lang_res k='member.fi'/]</a>
		</li>
		<li id="coporator_tab">
			<a href="javascript:;">[@lang_res k='member.corperate'/]</a>
		</li>
		<li id="ifa_tab">
			<a href="javascript:;">[@lang_res k='member.ifa'/]</a>
		</li>
	</ul>
	<div class="clear"></div>
	<div class="tab_wrap">
			<div class="form-inline" style="display: block;">
				<div>
					<div class="row pd10">
						<div class="col-md-4">
							<label for="s-1">
								[@lang_res k='member.list.keyword'/]
							</label>
							<input id='txtkeyword1' type="text" class="form-control indKeyWord" id="s-1">
						</div>

						<div class="col-md-4">
							<button type="button" class="btn btn-primary" id="btnSearch1">
								<i class="glyphicon glyphicon-search"></i> [@lang_res k='global.query'/]
							</button>
						</div>
					</div>
					<div class="clear"></div>
					
					<div class="pdt20">
					[#if editable?exists&editable]
						<a href="#" id="btnAdd1" class="btn-blue-s">[@lang_res k='global.add'/]</a>
                             [/#if]
					</div>
					
					<div>
						<table id="individuallist" border="0" cellpadding="0" cellspacing="0" class="table table-hover table-striped">
							<thead>
								<tr>
									<th class="table-head">
										[@lang_res k='member.info.loginCode'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.nickName'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.firstName'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.lastName'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.nameChn'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.country'/]
									</th>
									[#if editable?exists&editable]
									<th class="table-head">
										[@lang_res k='global.operate'/]
									</th>
									 [/#if]
								</tr>
							</thead>
							<tbody>

							</tbody>
						</table>
						<ul id='individualPagination' class="pagination pull-right now">

						</ul>
					</div>
				</div>
			</div>

			<div class="form-inline" style="display: none;">
				<div>
					<div class="row pd10">
						<div class="col-md-4">
							<label for="s-1">
								[@lang_res k='member.list.keyword'/]
							</label>
							<input id='txtkeyword2' type="text" class="form-control indKeyWord" id="s-1">
						</div>
						<div class="col-md-4">
							<button type="button" class="btn btn-primary" id="btnSearch2">
								<i class="glyphicon glyphicon-search"></i>[@lang_res k='global.query'/]
							</button>
						</div>
					</div>
					<div class="clear"></div>
				
					<div class="pdt20">
						[#if editable?exists&editable]
						<a href="#" id="btnAdd2" class="btn-blue-s">[@lang_res k='global.add'/]</a>
                                  [/#if]
					</div>
					
					<div>
						<table id="filist" border="0" cellpadding="0" cellspacing="0" class="table table-hover table-striped">
							<thead>
								<tr>
									<th class="table-head">
										[@lang_res k='member.info.loginCode'/]

									</th>
									<th class="table-head">
										[@lang_res k='member.info.nickName'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.email'/]

									</th>
									<th class="table-head">
										[@lang_res k='member.info.companyName'/]

									</th>
									[#if editable?exists&editable]
									<th class="table-head">
										[@lang_res k='global.operate'/]
									</th>
									 [/#if]
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<ul id='fiPagination' class="pagination pull-right">

						</ul>
					</div>
				</div>

			</div>

			<div class="form-inline" style="display: none;">
				<div>
					<div class="row pd10">
						<div class="col-md-4">
							<label for="s-1">
								[@lang_res k='member.list.keyword'/]
							</label>
							<input id='txtkeyword3' type="text" class="form-control indKeyWord" id="s-1">
						</div>
						<div class="col-md-4">
							<button type="button" class="btn btn-primary" id="btnSearch3">
								<i class="glyphicon glyphicon-search"></i> [@lang_res k='global.query'/]
							</button>
						</div>
					</div>
					<div class="clear"></div>
					
					<div class="pdt20">
					[#if editable?exists&editable]
						<a href="#" id="btnAdd3" class="btn-blue-s">[@lang_res k='global.add'/]</a>
					[/#if]
					</div>

					<div>
						<table id="coporatorList" border="0" cellpadding="0" cellspacing="0" class="table table-hover table-striped">
							<thead>
								<tr>
									<th class="table-head">
										[@lang_res k='member.info.loginCode'/]

									</th>
									<th class="table-head">
										[@lang_res k='member.info.nickName'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.nameChn'/]

									</th>
									<th class="table-head">
										[@lang_res k='member.info.companyName'/]

									</th>
									[#if editable?exists&editable]
									<th class="table-head">
										[@lang_res k='global.operate'/]
									</th>
									 [/#if]
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<ul id='coporatePagination' class="pagination pull-right">

						</ul>
					</div>
				</div>
			</div>

			<div class="form-inline" style="display: none;">
				<div>
					<div class="row pd10">
						<div class="col-md-4">
							<label for="s-1">
								[@lang_res k='member.list.keyword'/]
							</label>
							<input id='txtkeyword4' type="text" class="form-control indKeyWord" id="s-1">
						</div>
						<div class="col-md-4">
							<button type="button" class="btn btn-primary" id="btnSearch4">
								<i class="glyphicon glyphicon-search"></i> [@lang_res k='global.query'/]
							</button>
						</div>
					</div>
					<div class="clear"></div>
					
					<div class="pdt20">
					[#if editable?exists&editable]
						<a href="#" id="btnAdd4" class="btn-blue-s">[@lang_res k='global.add'/]</a>
                              [/#if]
					</div>
					
					<div>
						<table id="ifalist" border="0" cellpadding="0" cellspacing="0" class="table table-hover table-striped">
							<thead>
								<tr>
									<th class="table-head">
										[@lang_res k='member.info.loginCode'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.nickName'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.nameChn'/]
									</th>
									<th class="table-head">
										[@lang_res k='member.info.companyName'/]
									</th>
									[#if editable?exists&editable]
									<th class="table-head">
										[@lang_res k='global.operate'/]
									</th>
									 [/#if]

								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<ul id='ifaPagination' class="pagination pull-right">

						</ul>
					</div>
				</div>
			</div>
	</div>
</div>

<script src="${base}/res/console/js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="${base}/res/console/js/jquery.pagination.js"></script>
<script src="${base}/res/console/js/bootstrap.js" type="text/javascript"></script>
<script src="${base}/res/console/js/js.js" type="text/javascript"></script>
<script src="${base}/res/third/jqueryui/jquery-ui.js" type="text/javascript"></script>
<script src="${base}/res/third/dialog/js/bootstrap-dialog.js"></script>
<script src="${base}/res/third/layer/layer_v2.js"></script>
<script type="text/javascript">
	$(function() {
		bindIndividual(0);
		$("#btnSearch1,#individual_tab").bind("click", function() {
			bindIndividual(0);
		});
		$("#btnSearch2,#fi_tab").bind("click", function() {
			bindFi(0);
		});
		$("#btnSearch3,#coporator_tab").bind("click", function() {
			bindCoporator(0);
		});
		$("#btnSearch4,#ifa_tab").bind("click", function() {
			bindifa(0);
		});
        //individual添加按钮事件   add wwluo 160809
		$('#btnAdd1').click(function() {
		     var url = '${base}/console/member/individual/add.do';
			showform('console-member-individual','[@lang_res k="global.add"/]',url);
		});
		//fi添加按钮事件   add wwluo 160809
		$('#btnAdd2').click(function() {
		     var url = '${base}/console/member/fi/add.do';
			showform('console-member-fi','[@lang_res k="global.add"/]',url);
		});
		//individual添加按钮事件   add wwluo 160809
		$('#btnAdd3').click(function() {
		     var url = '${base}/console/member/coporate/add.do';
			showform('console-sys-param','[@lang_res k="global.add"/]',url);
		});
		//individual添加按钮事件   add wwluo 160809
		$('#btnAdd4').click(function() {
		     var url = '${base}/console/member/ifa/add.do';
			showform('console-member-ifa','[@lang_res k="global.add"/]',url);
		});
		 setAutoSearch('.indKeyWord',bindIndividual,0);
         setAutoSearch('.fiKeyWord',bindFi,0);
         setAutoSearch('.copKeyWord',bindCoporator,0);
         setAutoSearch('.ifaKeyWord',bindifa,0);
	});

	//按下回车键搜索
	document.onkeydown = function(e) {
		var ev = document.all ? window.event : e;
		if (ev.keyCode == 13) {
			if ($("#tab-search li:eq(0)").hasClass("tab-li-crr")) {
				bindIndividual(0);
			} else if ($("#tab-search li:eq(1)").hasClass("tab-li-crr")) {
				bindFi(0);
			} else if ($("#tab-search li:eq(2)").hasClass("tab-li-crr")) {
				bindCoporator(0);
			} else if ($("#tab-search li:eq(3)").hasClass("tab-li-crr")) {
				bindifa(0);
			}
		}
	};
	function bindIndividual(curPage) {
		$.ajax({
			type : 'post',
			datatype : 'json',
			url : '${base}/console/member/individual/listJson.do?datestr=' + new Date().getTime(),
			data : {
				'keyword' : $("#txtkeyword1").val(),
				'page' : curPage + 1,
				'rows' : 10,
				'sort' : '',
				'order' : ''
			},
			success : function(json) {
				var html = "";
				var total = json.total;
				var table = json.rows;
				$.each(table, function(i, n) {
					/*html += "<tr><td><a href='${base}/console/member/individual/detail.do?id=" + n.id + "'>" + n.loginCode + "</td><td>" + n.nickName + "</td><td>" + n.firstName + "</td><td>" + n.lastName + "</td><td>" + n.nameChn + "</td><td>" + n.country
					      + "</td>";
					[#if editable?exists&editable]
				    html+="<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId + "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;<a href='${base}/console/member/individual/detail.do?id=" + n.id + "'>[@lang_res  k='global.edit'/]<a/></td>";
                    [/#if]
					html+="</tr>";*/

					//modify wwluo 160809
					  var url = '${base}/console/member/individual/detail.do?id=' + n.id;
					  html += '<tr><td>'
		                    +           '<a href="#" onclick="showform(\''
						    +                n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
						    +             n.loginCode
						    +           '</a>'
						    + "</td><td>" + n.nickName + "</td><td>" + n.firstName + "</td><td>" + n.lastName + "</td><td>" + n.nameChn + "</td><td>" + n.country + "</td>";
                    
					  '[#if editable?exists&editable]'
					  var url = '${base}/console/member/individual/detail.do?id=' + n.id;
					  html += "<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId + "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;"
							+ '<a href="#" onclick="showform(\''
							+             n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
							+             '[@lang_res  k='global.edit'/]'
							+ '</a></td>';
					  '[/#if]'
					  html+="</tr>";
			        //end
								
					
				});

				$('#individuallist tbody').empty().append(html);
				console.log("individual:" + total);
				$("#individualPagination").pagination(total, {
					callback : pageselectCallback,
					numDetail : '',
					items_per_page : 10,
					num_display_entries : 4,
					current_page : curPage,
					num_edge_entries : 2
				});
			}
		});
		function pageselectCallback(page_id, jq) {
			bindIndividual(page_id);
		}
	}

	function bindFi(curPage) {

		$.ajax({
			type : 'post',
			datatype : 'json',
			url : '${base}/console/member/fi/listJson.do?datestr=' + new Date().getTime(),
			data : {
				'keyword' : $("#txtkeyword2").val(),
				'page' : curPage + 1,
				'rows' : 10,
				'sort' : '',
				'order' : ''
			},
			success : function(json) {
				var html = "";
				var total = json.total;
				var table = json.rows;
				$.each(table, function(i, n) {
				/*	html += "<tr><td><a href='${base}/console/member/fi/detail.do?id=" + n.id + "'>" + n.loginCode +
                     "</td><td>" + n.nickName + "</td><td>" + n.email+ "</td><td>" + n.companyName + "</td>";
				[#if editable?exists&editable]
				html+="<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId
							+ "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;<a href='${base}/console/member/fi/detail.do?id=" + n.id + "'>[@lang_res  k='global.edit'/]<a/></td>";
				[/#if]
				html+="</tr>";*/
				
				
				//modify wwluo 160810
					  var url = '${base}/console/member/fi/detail.do?id=' + n.id;
					  html += '<tr><td>'
		                    +           '<a href="#" onclick="showform(\''
						    +                n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
						    +             n.loginCode
						    +           '</a>'
						    + "</td><td>" + n.nickName + "</td><td>" + n.email + "</td><td>" + n.companyName + "</td>";
                    
					  '[#if editable?exists&editable]'
					  var url = '${base}/console/member/fi/detail.do?id=' + n.id;
					  html += "<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId + "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;"
							+ '<a href="#" onclick="showform(\''
							+             n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
							+             '[@lang_res  k='global.edit'/]'
							+ '</a></td>';
					  '[/#if]'
					  html+="</tr>";
			     //end
				
				
				});

				$('#filist tbody').empty().append(html);
				$("#fiPagination").pagination(total, {
					callback : pageselectCallback,
					numDetail : '',
					items_per_page : 10,
					num_display_entries : 4,
					current_page : curPage,
					num_edge_entries : 2
				});
			}
		});
		function pageselectCallback(page_id, jq) {
			bindFi(page_id);
		}
	}
	function bindCoporator(curPage) {

		$.ajax({
			type : 'post',
			datatype : 'json',
			url : '${base}/console/member/coporate/listJson.do?datestr=' + new Date().getTime(),
			data : {
				'keyword' : $("#txtkeyword3").val(),
				'page' : curPage + 1,
				'rows' : 10,
				'sort' : '',
				'order' : ''
			},
			success : function(json) {
				var html = "";
				var total = json.total;
				var table = json.rows;
				$.each(table, function(i, n) {
				/*	html += "<tr><td><a href='${base}/console/member/coporate/detail.do?id=" + n.id + "'>" + n.loginCode + "</td><td>" + n.nickName + "</td><td>" + n.companyName + "</td><td>" + n.country + "</td>";
				[#if editable?exists&editable]
				html+="<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId
							+ "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;<a href='${base}/console/member/coporate/detail.do?id=" + n.id + "'>[@lang_res  k='global.edit'/]<a/></td>";
				[/#if]
				html+="</tr>";*/
				
				//modify wwluo 160810
					  var url = '${base}/console/member/coporate/detail.do?id=' + n.id;
					  html += '<tr><td>'
		                    +           '<a href="#" onclick="showform(\''
						    +                n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
						    +             n.loginCode
						    +           '</a>'
						    + "</td><td>" + n.nickName + "</td><td>" + n.companyName + "</td><td>" + n.country + "</td>";
                    
					  '[#if editable?exists&editable]'
					  var url = '${base}/console/member/coporate/detail.do?id=' + n.id;
					  html += "<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId + "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;"
							+ '<a href="#" onclick="showform(\''
							+             n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
							+             '[@lang_res  k='global.edit'/]'
							+ '</a></td>';
					  '[/#if]'
					  html+="</tr>";
			     //end
				
				});

				$('#coporatorList tbody').empty().append(html);
				console.log("coporator:" + total);
				$("#coporatePagination").pagination(total, {
					callback : pageselectCallback,
					numDetail : '',
					items_per_page : 10,
					num_display_entries : 4,
					current_page : curPage,
					num_edge_entries : 2
				});
			}
		});
		function pageselectCallback(page_id, jq) {
			bindCoporator(page_id);
		}
	}

	function bindifa(curPage) {
		$.ajax({
			type : 'post',
			datatype : 'json',
			url : '${base}/console/member/ifa/listJson.do?datestr=' + new Date().getTime(),
			data : {
				'keyword' : $("#txtkeyword4").val(),
				'page' : curPage + 1,
				'rows' : 10,
				'sort' : '',
				'order' : ''
			},
			success : function(json) {
				var html = "";
				var total = json.total;
				var table = json.rows;
				$.each(table, function(i, n) {
				/*	html += "<tr><td><a href='${base}/console/member/ifa/detail.do?id=" + n.id + "'>" + n.loginCode + "</td><td>" + n.nickName + "</td><td>" + n.firstName + "</td><td>" + n.companyIfafirm + "</td>";
				[#if editable?exists&editable]
				html+="<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId
							+ "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;<a href='${base}/console/member/ifa/detail.do?id=" + n.id + "'>[@lang_res  k='global.edit'/]<a/></td>";
				[/#if]
				html+="</tr>";*/
				
				//modify wwluo 160810
					  var url = '${base}/console/member/ifa/detail.do?id=' + n.id;
					  html += '<tr><td>'
		                    +           '<a href="#" onclick="showform(\''
						    +                n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
						    +             n.loginCode
						    +           '</a>'
						    + "</td><td>" + n.nickName + "</td><td>" + n.firstName + "</td><td>" + n.companyIfafirm + "</td>";
                    
					  '[#if editable?exists&editable]'
					  var url = '${base}/console/member/ifa/detail.do?id=' + n.id;
					  html += "<td><a href='#' onclick='javascript:deleteMember(\"" + n.memberId + "\");'>[@lang_res  k='global.delete'/]<a/>&nbsp;&nbsp;"
							+ '<a href="#" onclick="showform(\''
							+             n.id  + '\',\''+ n.loginCode + '\',\'' + url + '\')">'
							+             '[@lang_res  k='global.edit'/]'
							+ '</a></td>';
					  '[/#if]'
					  html+="</tr>";
			     //end
				
				});

				$('#ifalist tbody').empty().append(html);
				console.log("ifa:" + total);
				$("#ifaPagination").pagination(total, {
					callback : pageselectCallback,
					numDetail : '',
					items_per_page : 10,
					num_display_entries : 4,
					current_page : curPage,
					num_edge_entries : 2
				});
			}
		});
		function pageselectCallback(page_id, jq) {
			bindifa(page_id);
		}
	}

	function deleteMember(id) {
		layer.confirm("[@lang_res k='global.confirm.delete'/]", {
			title : "[@lang_res k='global.prompt'/]",
			icon : 3,
			btn : [ "[@lang_res k='global.confirm'/]", "[@lang_res k='global.cancel'/]" ]
		}, function() {
			$.ajax({
				type : "post",
				datatype : "json",
				url : "${base}/console/member/delete.do?memberId=" + id,
				data : {},
				success : function(json) {
					if (json != undefined && json.result == true) {
						layer.msg("[@lang_res k='global.delete'/] [@lang_res k='global.success'/]", {
							title : "[@lang_res k='global.prompt'/]",
							icon : 1,
							time : 1000
						});
						if ($("#tab-search li:eq(0)").hasClass("tab-li-crr")) {
							bindIndividual(0);
						} else if ($("#tab-search li:eq(1)").hasClass("tab-li-crr")) {
							bindFi(0);
						} else if ($("#tab-search li:eq(2)").hasClass("tab-li-crr")) {
							bindCoporator(0);
						} else if ($("#tab-search li:eq(3)").hasClass("tab-li-crr")) {
							bindifa(0);
						}
					} else {
						layer.msg("[@lang_res k='global.delete'/] [@lang_res k='global.failed'/]", {
							title : "[@lang_res k='global.prompt'/]",
							icon : 5,
							time : 1000
						});
					}
				}
			})
		})
	}
</script>