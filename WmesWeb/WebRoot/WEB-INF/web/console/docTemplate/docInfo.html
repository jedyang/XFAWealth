<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
		<link href="${base}/res/console/css/bootstrap-3.3.4.css" rel="stylesheet" type="text/css">
		<link href="${base}/res/console/css/css.css" rel="stylesheet" type="text/css">
		<link href="${base}/res/third/dialog/css/bootstrap-dialog.css" rel="stylesheet">
        <link href="${base}/res/third/laydate/need/laydate.css" rel="stylesheet" type="text/css">
        <link href="${base}/res/third/laydate/skins/yalan/laydate.css" rel="stylesheet" type="text/css">
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
 		<script src="${base}/res/js/html5shiv.min.js"></script>
	  	<script src="${base}/res/js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
		<!-- header -->
		<div class="tab_wrap" id="wmes_wraper">
			<form class="form-horizontal" id="infofrm" method="post">
				<input type="hidden" id="id" name="doc.id" value="${(doc.id)?if_exists}">
				<input type="hidden" name="doc.template.id" value="${(tempId)?if_exists}" id="tempId">
				[#if doc?exists]
				<input type="hidden" name="doc.createTime" value="${(doc.createTime)?if_exists}">
				<input type="hidden" name="doc.isValid" value="${(doc.isValid)?if_exists}">
				[/#if]
				<input type="hidden" name="docEn.id" value="${(doc.id)?if_exists}">
				<input type="hidden" name="docTc.id" value="${(doc.id)?if_exists}">
				<input type="hidden" name="docSc.id" value="${(doc.id)?if_exists}">
					[#if docModelList?exists]
					<div class="form-group">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="txtType" class="label-control">
								[@lang_res k='console.docTemplate.docModel.addFromModel'/]
							</label>
						</div>
						<div class="col-sm-7">
							<select id="docModel" class="form-control ">
								<option value="${doc.id!}">
									[@lang_res k='global.pleaseSelect'/]
								</option>
								[#list  docModelList as docModel]
								<option value="${docModel.id!}">${docModel.docName!}</option>
								[/#list]
							</select>
						</div>
					</div>
					[/#if]
					<div class="form-group">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="txtType" class="label-control">
								[@lang_res k='console.docTemplate.detail.titleEn'/]
							</label>
						</div>
						<div class="col-sm-7">
							<input id="titleEn" class="form-control" name="docEn.docName" maxlength="200" value="${(docEn.docName)?if_exists}">
						</div>
					</div>
					<div class="form-group" id="divIfafirm">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="txtType" class="label-control">
								[@lang_res k='console.docTemplate.detail.titleSc'/]
							</label>
						</div>
						<div class="col-sm-7">
							<input id="titleSc" class="form-control" name="docSc.docName" maxlength="200" value="${(docSc.docName)?if_exists}">
						</div>
					</div>
	
					<div class="form-group" id="divDistributor">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="txtType" class="label-control">
								[@lang_res k='console.docTemplate.detail.titleTc'/]
							</label>
						</div>
						<div class="col-sm-7">
							<input id="titleTc" class="form-control" name="docTc.docName" maxlength="200" value="${(docTc.docName)?if_exists}">
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="txtRemark" class="label-control">
								[@lang_res k='console.docTemplate.detail.ifNecessary'/]
							</label>
						</div>
						<div class="col-sm-7">
							<span class="radio-s-middle"> &nbsp; 
								<input type="radio" class="CFalgItem"
									value="1" id="isDef-0" name="doc.isNecessary" 
									[#if doc?exists && doc.isNecessary=='1']checked[/#if]>[@lang_res k='global.true'/]
								&nbsp;&nbsp;&nbsp;&nbsp; 
								<input type="radio" value="0" class="CFalgItem" id="isDef-1" name="doc.isNecessary" 
									[#if doc?exists && doc.isNecessary=='0']checked[/#if]>[@lang_res k='global.false'/]
							</span>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="txtRemark" class="label-control">
								[@lang_res k='ifa.crm.kyc.UpdatePeriod'/]
							</label>
						</div>
						<div class="col-sm-4">
							<input id="updateCycle" class="form-control" name="doc.updateCycle" maxlength="2" value="${(doc.updateCycle)?if_exists}"> 
						</div>
						<div class="col-sm-2">
                            <label for="txtRemark" class="label-control"> [@lang_res k='open.account.docCheck.period'/]</label>
                        </div>
					</div>
					<!-- 
					<div class="form-group">
						<div class="col-sm-3 text-right">
						  <span class="red">* </span>
							<label for="effectDate" class="label-control">
								[@lang_res k='console.docTemplate.detail.effTime'/]
							</label>
						</div>
						<div class="col-sm-4">
							<input id='effectDate' name="effectTime" value="[@date_fmt s=doc.effectDate /]" type="text" class="laydate-icon form-control form-control-laydate" readonly style="height: 34px; padding: 6px 12px;" onclick="laydate({istime: false, format: 'YYYY-MM-DD'})" >
                   		</div>
					</div>
					 -->
					<div class="form-group">
						<div class="col-sm-3 text-right">
							<label for="txtRemark" class="label-control">
								[@lang_res k='console.docTemplate.docInfo.remarkEn'/]
							</label>
						</div>
						<div class="col-sm-7">
							<textarea rows="5" class="form-control " id="enRemark" name="docEn.remark"
							placeholder="[@lang_res k='console.docTemplate.docInfo.remarkEn'/]">${(docEn.remark)?if_exists}</textarea>
                   		</div>
					</div>
					<div class="form-group">
						<div class="col-sm-3 text-right">
							<label for="txtRemark" class="label-control">
								[@lang_res k='console.docTemplate.docInfo.remarkSc'/]
							</label>
						</div>
						<div class="col-sm-7">
							<textarea rows="5" class="form-control " id="scRemark" name="docSc.remark"
							placeholder="[@lang_res k='console.docTemplate.docInfo.remarkSc'/]">${(docSc.remark)?if_exists}</textarea>
                   		</div>
					</div>
					<div class="form-group">
						<div class="col-sm-3 text-right">
							<label for="txtRemark" class="label-control">
								[@lang_res k='console.docTemplate.docInfo.remarkTc'/]
							</label>
						</div>
						<div class="col-sm-7">
							<textarea rows="5" class="form-control " id="tcRemark" name="docTc.remark"
							placeholder="[@lang_res k='console.docTemplate.docInfo.remarkTc'/]">${(docTc.remark)?if_exists}</textarea>
                   		</div>
					</div>
					<div class="text-center pd10">
			           	<button id="btnSave" type="submit"class="btn-blue-s" >[@lang_res k='global.save'/]</button>
					</div>
			</form>
		</div>
<script src="${base}/res/console/js/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="${base}/res/console/js/bootstrap.js" type="text/javascript"></script>
<script src="${base}/res/console/js/js.js" type="text/javascript"></script>
<script src="${base}/res/third/bootstrap/js/bootstrapValidator.js"></script>
<script src="${base}/res/console/js/jquery.form.js"></script>
<script src="${base}/res/third/dialog/js/bootstrap-dialog.js"></script>
<script src="${base}/res/third/laydate/laydate.js"></script>
<script src="${base}/res/third/layer/layer_v2.js"></script>
<script type="text/javascript">
	$(function() {
		
		$("#infofrm").bootstrapValidator({
			feedbackIcons : {
				valid : 'glyphicon glyphicon-ok',
				invalid : 'glyphicon glyphicon-remove',
				validating : 'glyphicon glyphicon-refresh'
			},
			fields : {
				"docSc.docName":{
					validators: {
	                    notEmpty: {
	                        message: "[@lang_res k='console.docTemplate.detail.titleScEmpty'/]"
	                    }
	                }
				},
				"docTc.docName":{
					validators: {
	                    notEmpty: {
	                        message: "[@lang_res k='console.docTemplate.detail.titleTcEmpty'/]"
	                    }
	                }
				},
				"docEn.docName":{
					validators: {
	                    notEmpty: {
	                        message: "[@lang_res k='console.docTemplate.detail.titleEnEmpty'/]"
	                    }
	                }
				},
				"doc.isNecessary":{
					validators: {
	                    notEmpty: {
	                        message: "[@lang_res k='console.docTemplate.detail.ifDefEmpty'/]"
	                    }
	                }
				},
				"doc.updateCycle":{
                    validators: {
                        notEmpty: {
                            message: "[@lang_res k='console.docTemplate.docInfo.updatePriodEmpty'/]"
                        },
                        regexp:{
                            regexp: /^[0-9_]{1,2}/i,
                            message: "[@lang_res k='console.docTemplate.docInfo.updatePriodInt'/]"
                        }
                    },
                    
                }/***,
				"effectTime":{
                    validators: {
                        notEmpty: {
                            message: "[@lang_res k='console.docTemplate.docInfo.effTimeEmpty'/]"
                        }
                    }
                }***/
			}
		}).on('success.form.bv', function(e) {
			e.preventDefault();
			infoSave();
		});	
		
		var types = [ BootstrapDialog.TYPE_DEFAULT, 
		              BootstrapDialog.TYPE_INFO, 
		              BootstrapDialog.TYPE_PRIMARY, 
		              BootstrapDialog.TYPE_SUCCESS, 
		              BootstrapDialog.TYPE_WARNING, 
		              BootstrapDialog.TYPE_DANGER ];
		
		//加载已定义文档
		$("#docModel").on("change",function(){
			//alert($(this).val());
			var docId= $(this).val();
			if(!!docId){
				$.ajax({
					url:"${base}/console/docTemplate/loadDocModelData.do?docModelId="+docId+"&r="+Math.random(),
					type:"post",
					dataType:"json",
					success:function(data){
						//alert(data.docDate);
						var obj = data.docDate;
						var docInfo = obj.doc;
						var docInfoEn = obj.docEn;
						var docInfoTc = obj.docTc;
						var docInfoSc = obj.docSc;
						$("#titleEn").val(docInfoEn.docName);
						$("#titleSc").val(docInfoSc.docName);
						$("#titleTc").val(docInfoTc.docName);
						if("0"==docInfo.isNecessary){
							$("#isDef-1").attr("checked","checked");
						}else{
							$("#isDef-0").attr("checked","checked");
						}
						$("#updateCycle").val(docInfo.updateCycle);
						//$("#effectDate").val(docInfo.effectDate);
						$("#enRemark").val(docInfoEn.remark);
						$("#scRemark").val(docInfoSc.remark);
						$("#tcRemark").val(docInfoTc.remark);
					},
					error:function(){
						
					}
				})
			}
		})
		
		
	});
	
	function infoSave(){
        var postData = $("#infofrm").serialize();
        //console.log(postData);
		$("#infofrm").ajaxSubmit({
		    type: 'post',
			url : "${base}/console/docTemplate/docInfoSave.do?datestr=" + new Date().getTime(),
			data: postData,
            async: false,
            dataType: "json",
			iframe : true,
			success : function(data, status) {
				var dataObj = data;//$.parseJSON(data.replace(/<.*?>/ig, ""));
				if (dataObj.result) {
				    layer.msg("[@lang_res k='global.success.save'/]", {icon : 2,time : 1000,},function(){
						$("#id").val(dataObj.id);
						$("#btnSave").removeAttr("disabled");
						parent.document.getElementById("btnSearch1").click();
						parent.document.getElementById("btnCloseIframe").click();
					});
				} else {
					$('#contact-form-error').show().fadeOut(10000);
				}
			},
			error : function() {
				$('#contact-form-error').show().fadeOut(10000);
			}
		});
	}
</script>
	</body>
</html>
